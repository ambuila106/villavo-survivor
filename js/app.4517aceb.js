(function(){"use strict";var t={3440:function(t,e,i){var n=i(5130),s=i(5892),a=i(6768);function r(t,e,i,n,s,r){const o=(0,a.g2)("VillavicencioGame");return(0,a.uX)(),(0,a.Wv)(o)}var o=i(4232);const l={class:"wrap"},c={key:0,class:"leaderboard top"},h={id:"ui"},u={class:"panel"},d={id:"time"},v={id:"collected",class:"meter"};function p(t,e,i,n,s,r){const p=(0,a.g2)("GameAlert");return(0,a.uX)(),(0,a.CE)("div",l,[e[12]||(e[12]=(0,a.Lk)("h1",null,"Villavicencio Survivor — 10 segundos",-1)),s.topPlayer?((0,a.uX)(),(0,a.CE)("div",c,[e[6]||(e[6]=(0,a.Lk)("h3",null,"Mejor puntaje",-1)),(0,a.Lk)("p",null,(0,o.v_)(s.topPlayer.name)+" de "+(0,o.v_)(s.topPlayer.barrio)+": "+(0,o.v_)(s.topPlayer.score),1)])):(0,a.Q3)("",!0),(0,a.Lk)("div",h,[(0,a.Lk)("div",u,[(0,a.Lk)("div",null,[e[7]||(e[7]=(0,a.eW)("Tiempo: ",-1)),(0,a.Lk)("span",d,(0,o.v_)(s.remaining.toFixed(1)),1),e[8]||(e[8]=(0,a.eW)("s",-1))]),e[10]||(e[10]=(0,a.Lk)("div",{style:{width:"16px"}},null,-1)),(0,a.Lk)("div",null,[e[9]||(e[9]=(0,a.eW)("Agua recogida: ",-1)),(0,a.Lk)("span",v,(0,o.v_)(s.collected),1)])]),(0,a.Lk)("button",{id:"startBtn",onClick:e[0]||(e[0]=(...t)=>r.startGame&&r.startGame(...t))},(0,o.v_)(s.startBtnText),1),e[11]||(e[11]=(0,a.Lk)("div",{class:"notice"},"Mueve la caneca con el dedo o el ratón. Esquiva los derrumbes de tierra. Si te golpean, pierdes 10 puntos.",-1))]),(0,a.Lk)("canvas",{ref:"gameCanvas",id:"gameCanvas",width:"720",height:"480",onPointerdown:e[1]||(e[1]=(...t)=>r.handlePointerDown&&r.handlePointerDown(...t)),onPointermove:e[2]||(e[2]=(...t)=>r.handlePointerMove&&r.handlePointerMove(...t)),onPointerup:e[3]||(e[3]=(...t)=>r.handlePointerUp&&r.handlePointerUp(...t)),onPointercancel:e[4]||(e[4]=(...t)=>r.handlePointerCancel&&r.handlePointerCancel(...t))},null,544),e[13]||(e[13]=(0,a.Lk)("div",{class:"panel",style:{"margin-top":"6px"}},[(0,a.Lk)("small",null,"Consejo: toca y arrastra la caneca. Cada derrumbe te quita puntos.")],-1)),(0,a.bF)(p,{show:s.showForm,score:s.collected,onSubmit:r.handleSubmit,onClose:e[5]||(e[5]=t=>s.showForm=!1)},null,8,["show","score","onSubmit"])])}i(4114);var m=i(1239),b=i(6400);const f={apiKey:"AIzaSyCu_utqnP4sTuBMI7nXDNz6n464eJQ0iUM",authDomain:"villavicencio-survivor.firebaseapp.com",databaseURL:"https://villavicencio-survivor-default-rtdb.firebaseio.com",projectId:"villavicencio-survivor",storageBucket:"villavicencio-survivor.firebasestorage.app",messagingSenderId:"305013959175",appId:"1:305013959175:web:4fe785561f3ed05ac8d8a2",measurementId:"G-85N9PJK7FM"},y=(0,b.Wp)(f),k=(0,m.C3)(y);function g(t,e,i,s,r,l){return i.show?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"alert-overlay",onClick:e[4]||(e[4]=(...t)=>l.close&&l.close(...t))},[(0,a.Lk)("div",{class:"alert-card",onClick:e[3]||(e[3]=(0,n.D$)(()=>{},["stop"]))},[e[5]||(e[5]=(0,a.Lk)("h2",null,"¡Juego terminado!",-1)),(0,a.Lk)("p",null,"Agua recogida: "+(0,o.v_)(i.score),1),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.playerName=t),placeholder:"Tu nombre"},null,512),[[n.Jo,r.playerName]]),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.playerBarrio=t),placeholder:"Tu barrio"},null,512),[[n.Jo,r.playerBarrio]]),(0,a.Lk)("button",{onClick:e[2]||(e[2]=(...t)=>l.submit&&l.submit(...t))},"Guardar puntaje")])])):(0,a.Q3)("",!0)}var w={name:"GameAlert",props:{show:Boolean,score:Number},data(){return{playerName:"",playerBarrio:""}},methods:{submit(){this.playerName&&this.playerBarrio&&(this.$emit("submit",{name:this.playerName,barrio:this.playerBarrio,score:this.score}),this.playerName="",this.playerBarrio="")},close(){this.$emit("close")}}},x=i(1241);const P=(0,x.A)(w,[["render",g],["__scopeId","data-v-0ab7138d"]]);var C=P,T={name:"VillavicencioGame",components:{GameAlert:C},data(){return{canvas:null,ctx:null,W:720,H:480,running:!1,lastTime:0,GAME_DURATION:10,remaining:10,collected:0,bucket:{x:320,y:400,w:80,h:50},rain:[],debris:[],rainTimer:0,debrisTimer:0,pointerDown:!1,pointerId:null,startBtnText:"Iniciar",showForm:!1,topPlayer:null}},mounted(){this.canvas=this.$refs.gameCanvas,this.ctx=this.canvas.getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",this.resizeCanvas),this.loop();const t=(0,m.KR)(k,"scores"),e=(0,m.P)(t,(0,m.kT)("score"),(0,m.$1)(1));(0,m.Zy)(e,t=>{const e=t.val();if(e){const t=Object.keys(e)[0];this.topPlayer=e[t]}else this.topPlayer=null})},beforeUnmount(){window.removeEventListener("resize",this.resizeCanvas)},methods:{resizeCanvas(){const t=this.canvas.getBoundingClientRect();this.canvas._scaleX=this.canvas.width/t.width,this.canvas._scaleY=this.canvas.height/t.height},spawnRain(){const t=2*Math.random()+1;for(let e=0;e<t;e++)this.rain.push({x:Math.random()*this.W,y:-10,r:3+3*Math.random(),vy:250+250*Math.random(),value:1})},spawnDebris(){const t=20+40*Math.random();this.debris.push({x:Math.random()*(this.W-t),y:-20,w:t,h:t,vy:280+220*Math.random()})},moveBucketToEvent(t){const e=this.canvas.getBoundingClientRect(),i=(t.clientX-e.left)*this.canvas._scaleX,n=(t.clientY-e.top)*this.canvas._scaleY;this.bucket.x=Math.max(0,Math.min(this.W-this.bucket.w,i-this.bucket.w/2)),this.bucket.y=Math.max(this.H/2,Math.min(this.H-this.bucket.h-10,n-this.bucket.h/2))},circleRectCollision(t,e,i,n,s,a,r){const o=Math.max(n,Math.min(t,n+a)),l=Math.max(s,Math.min(e,s+r)),c=t-o,h=e-l;return c*c+h*h<=i*i},rectRectCollision(t,e){return!(t.x+t.w<e.x||t.x>e.x+e.w||t.y+t.h<e.y||t.y>e.y+e.h)},update(t){if(this.running){this.remaining-=t,this.remaining<=0&&(this.remaining=0,this.running=!1,this.finishGame()),this.rainTimer+=t,this.rainTimer>.04&&(this.spawnRain(),this.rainTimer=0),this.debrisTimer+=t,this.debrisTimer>.07+.8*Math.random()&&(this.spawnDebris(),this.debrisTimer=0);for(let e=this.rain.length-1;e>=0;e--){const i=this.rain[e];i.y+=i.vy*t,this.circleRectCollision(i.x,i.y,i.r,this.bucket.x,this.bucket.y,this.bucket.w,this.bucket.h)?(this.collected+=i.value,this.rain.splice(e,1)):i.y>this.H+20&&this.rain.splice(e,1)}for(let e=this.debris.length-1;e>=0;e--){const i=this.debris[e];i.y+=i.vy*t,this.rectRectCollision(i,this.bucket)&&(this.collected=Math.max(0,this.collected-10),this.debris.splice(e,1),console.log("¡Un derrumbe te golpeó! Pierdes 10 puntos.")),i.y>this.H+50&&this.debris.splice(e,1)}}},draw(){this.ctx.clearRect(0,0,this.W,this.H);const t=this.ctx.createLinearGradient(0,0,0,this.H);t.addColorStop(0,"#0b2a43"),t.addColorStop(1,"#072032"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.W,this.H);for(const n of this.rain)this.ctx.beginPath(),this.ctx.fillStyle="rgba(170,220,255,0.95)",this.ctx.arc(n.x,n.y,n.r,0,2*Math.PI),this.ctx.fill();for(const n of this.debris)this.ctx.fillStyle="#8b5a2b",this.ctx.beginPath(),this.ctx.arc(n.x+n.w/2,n.y+n.h/2,n.w/2,0,2*Math.PI),this.ctx.fill();this.ctx.beginPath(),this.ctx.fillStyle="#fff",this.roundRect(this.ctx,this.bucket.x,this.bucket.y,this.bucket.w,this.bucket.h,8),this.ctx.fill();const e=200,i=Math.min(this.bucket.h-6,this.collected/e*(this.bucket.h-6));this.ctx.fillStyle="rgba(96,165,250,0.95)",this.ctx.fillRect(this.bucket.x+6,this.bucket.y+this.bucket.h-3-i,this.bucket.w-12,i),!this.running&&this.remaining},roundRect(t,e,i,n,s,a){t.beginPath(),t.moveTo(e+a,i),t.arcTo(e+n,i,e+n,i+s,a),t.arcTo(e+n,i+s,e,i+s,a),t.arcTo(e,i+s,e,i,a),t.arcTo(e,i,e+n,i,a),t.closePath()},finishGame(){this.showForm=!0},handleSubmit(t){(0,m.VC)((0,m.KR)(k,"scores"),t),this.showForm=!1,this.startBtnText="Reiniciar"},loop(t){this.lastTime||(this.lastTime=t);const e=(t-this.lastTime)/1e3;this.lastTime=t,this.update(e),this.draw(),requestAnimationFrame(this.loop)},startGame(){this.running||(this.collected=0,this.rain=[],this.debris=[],this.remaining=this.GAME_DURATION,this.running=!0,this.lastTime=0,this.startBtnText="Jugando...")},handlePointerDown(t){this.running||this.startGame(),this.pointerDown=!0,this.pointerId=t.pointerId,this.canvas.setPointerCapture(this.pointerId),this.moveBucketToEvent(t)},handlePointerMove(t){this.pointerDown&&this.moveBucketToEvent(t)},handlePointerUp(t){t.pointerId===this.pointerId&&(this.pointerDown=!1,this.canvas.releasePointerCapture(this.pointerId),this.pointerId=null)},handlePointerCancel(){this.pointerDown=!1,this.pointerId=null}}};const M=(0,x.A)(T,[["render",p],["__scopeId","data-v-7cddf657"]]);var L=M,I={name:"App",components:{VillavicencioGame:L}};const _=(0,x.A)(I,[["render",r]]);var B=_;const R=(0,n.Ef)(B);R.use(s["default"],{config:{id:"G-85N9PJK7FM"},enabled:!0}),R.mount("#app")}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,i),a.exports}i.m=t,function(){var t=[];i.O=function(e,n,s,a){if(!n){var r=1/0;for(h=0;h<t.length;h++){n=t[h][0],s=t[h][1],a=t[h][2];for(var o=!0,l=0;l<n.length;l++)(!1&a||r>=a)&&Object.keys(i.O).every(function(t){return i.O[t](n[l])})?n.splice(l--,1):(o=!1,a<r&&(r=a));if(o){t.splice(h--,1);var c=s();void 0!==c&&(e=c)}}return e}a=a||0;for(var h=t.length;h>0&&t[h-1][2]>a;h--)t[h]=t[h-1];t[h]=[n,s,a]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};i.O.j=function(e){return 0===t[e]};var e=function(e,n){var s,a,r=n[0],o=n[1],l=n[2],c=0;if(r.some(function(e){return 0!==t[e]})){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(l)var h=l(i)}for(e&&e(n);c<r.length;c++)a=r[c],i.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return i.O(h)},n=self["webpackChunkvillavo_survivor"]=self["webpackChunkvillavo_survivor"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=i.O(void 0,[504],function(){return i(3440)});n=i.O(n)})();
//# sourceMappingURL=app.4517aceb.js.map